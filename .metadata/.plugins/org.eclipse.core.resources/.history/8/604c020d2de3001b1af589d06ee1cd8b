package dao;

import java.util.List;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.SessionScoped;
import model.Tarefa;

@ManagedBean
@SessionScoped
public class TarefaBean {

    private Tarefa tar = new Tarefa();
    private List<Tarefa> tarefas;

    public TarefaBean() {
        tar.setId(null);
    }

    public Tarefa getTar() {
        return tar;
    }

    public void setTar(Tarefa tar) {
        this.tar = tar;
    }

    public String salva() {

        EntityManager em = JPAUtil.getEntityManager();
        try {
            em.getTransaction().begin();
            if (tar.getId() == null) {
                em.persist(tar);
            } else {
                tar = em.merge(tar);
            }
            em.getTransaction().commit();
        } finally {
            em.close();
        }

        this.tarefas = null;
        return "ListarTarefas";
    }

    public List<Tarefa> getTarefas() {

        if (this.tarefas == null) {
            EntityManager em = JPAUtil.getEntityManager();
            Query q = em.createQuery("select a from Tarefa a",
            		Tarefa.class);
            this.tarefas = q.getResultList();
            em.close();
        }
        return tarefas;
    }

    public void excluir(Tarefa tarefa) {

        if (tarefa.getId() != null) {
            EntityManager em = JPAUtil.getEntityManager();

            System.out.println(tarefa.getId() + ", " + tarefa.getTitulo());
            em.getTransaction().begin();
            tarefa = em.merge(tarefa);
            em.remove(tarefa);
            em.getTransaction().commit();
            em.close();
        }

        this.tarefas = null;

    }

    public String alterar(Tarefa t) {
        this.tar = t;
        return "CadastrarTarefa";
    }

    public String cadastrarNova(String complemento) {
        tar = new Tarefa();
        return complemento + "CadastrarTarefa";
    }
}